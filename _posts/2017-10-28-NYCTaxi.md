---
layout: post
title: Exploring NYC Taxi Data
---


![_config.yml]({{ site.baseurl }}/images/nyctaxi_trips_scatter.png)

# Summary  
This post explores a subset of the NYC taxi dataset for the month of April 2013. I extract, transform and load the trip fare and trip details csv files into a sqlite database. I use this data to predict the fare and tip taxi drivers will receive. The repository containing my entire analysis is [here](https://github.com/factorwonk/nyctaxifare)

### ETL 
The April 2013 taxi data is provided in two csv files: trip_details and trip_fares. I extract, transform and load these csv files into two separate tables: trips_table and fares_table in a SQLite database. I make subsequent calls to these tables in my EDA and modeling notebooks. The ETL process is detailed [here](https://github.com/factorwonk/nyctaxifare/blob/master/nyctaxi_createdb.ipynb)

### Data Cleaning
Each table is cleaned for outliers including restricting latitude and longitude co-ordinates to lie in beween (40.67, -74.027) and (40.85, -73.85). I remove trips that last for 0 minutes and 0 miles. I also restrict the dataset to all trips made within New York City alone and it's two closest airports: La Guardia and JFK International. This excludes trips made to Westchester and Nassau counties (Rate Code 4) as well as out of town trips (Rate Code 5) which are negotiated at a flat fee, where the odometer or trip time is not indicative of the distance or duration of the trip. While these actions may bias the results, **99.84%** of all trips in April 2013 were made within the city of New York. A few thousand trips have their payment registered as 'Disputed', 'No Charge' or 'Unknown'. These trips were excluded as overwhelmingly, passengers paid by credit card or cash. Finally, the NYC Taxi and Limousine company permits a maximum of 6 passengers in a 5 passenger taxicab, if the sixth passenger is a child under 7 who can sit on an adult's lap. I screen out all trips with more than 6 passengers.

### Data Merging  
Using taxi medallion as unqiue taxicab identifier, hack license as unique driver identifer, vendor id and pickup_datetime as common keys, I merge the two tables above and return just over 14 million rows of data. Going forward, I use the assignment questions to propel my EDA of the dataset.

# Analysis

## Q1. What is the distribution of the number of passengers in each cab?

Overwhelmingly taxi cabs are hailed by a sole passenger. More cabs are hailed by a single passenger than the _total_ number of cabs hailed by two or more passengers as shown in Figure 1.

<p align="center">
Figure 1
</p>
![_config.yml]({{ site.baseurl }}/images/nyctaxi_passenger_dist.png)

## Q2. Do most customers pay with cash or card?

The results are pretty close, with nearly 54% of trips being paid for by credit card. 

<p align="center">
Figure 2
</p>
![_config.yml]({{ site.baseurl }}/images/nyctaxi_pmt_type.png)

Are tips affected by whether people pay by cash or card?

## Q3. What does the distribution of fare amounts look like?

While the most expensive fare amount was $204, most fares are under $35.

<p align="center">
Figure 3
</p>
![_config.yml]({{ site.baseurl }}/images/nyctaxi_fare_amt_dist.png)

Winsorizing the fare amount data by removing the top and bottom 1% shows the median fare amount is $9 as shown below. The bottom 5% of fare amounts is less than $5 while the top 95% of fares is higher than $24. 

<p align="center">
Figure 4
</p>
![_config.yml]({{ site.baseurl }}/images/nyctaxi_fare_amt_winsorized_dist.png)


**Further Questions**
It would be interesting to see the impact of services such as Uber or Lyft on taxi demand over time. I was struck by the relatively low percentage of taxis being taken to the Airports in particular.


